lbf2newton = 4.4482216152605;
ounce2kilogram = .02834952;
newton2kilogram = 9.81;
lbf2kilogram = lbf2newton / newton2kilogram;
ft2meter = 1/3.28;
in2meter = 1/12/3.28;

%% Find value index of apogee for each source
% OpenRocket
indexmax_openrocket = find(max(openrocket_Altitudem) == openrocket_Altitudem);
time_to_apogee_openrocket = openrocket_VarName1(indexmax_openrocket);
openrocket_altitude_max = openrocket_Altitudem(indexmax_openrocket);

% RasAero
indexmax_rasaero = find(max(rasaero_Altitudeft) == rasaero_Altitudeft);
time_to_apogee_rasaero = rasaero_Timesec(indexmax_rasaero);
rasaero_altitude_max = rasaero_Altitudeft(indexmax_rasaero);

% RockSim
indexmax_Rocksim = find(max(Rocksim_AltitudeFeet) == Rocksim_AltitudeFeet);
time_to_apogee_Rocksim = Rocksim_Time(indexmax_Rocksim);
Rocksim_altitude_max = Rocksim_AltitudeFeet(indexmax_Rocksim);

%% Dynamic Parameters vs Time
figure;
%% COP vs time
subplot(3,1,1)

matlab_plot_1 = plot(tout, cop_rocket, 'm--*');
hold on;
openrocket_plot_1 = plot(...
    openrocket_VarName1(1:indexmax_openrocket), ...
    openrocket_CPlocationcm(1:indexmax_openrocket)/100, ...
    'b--.'...
);
%{
rasaero_plot_1 = plot( ...
    rasaero_Timesec(1:indexmax_rasaero), ...
    rasaero_CP(1:indexmax_rasaero)*in2meter, ...
    'c--o' ...
);
%}
rocksim_plot_1 = plot( ...
    Rocksim_Time(1:indexmax_Rocksim), ...
    Rocksim_CPInches(1:indexmax_Rocksim)*in2meter, ...
    'k- .' ...
);
hold off

h_legend_1 = legend(...
    [matlab_plot_1, openrocket_plot_1, rocksim_plot_1],...
    'Matlab','OpenRocket','Rocksim', ...
    'location', 'northeast' ...
);
set(h_legend_1,'FontSize',12);
set(h_legend_1,'FontName','Courier New');

clear title xlabel ylabel
title('COP vs Time');
ylabel('COP (m)');
xlabel('Time (s)');

%% COG vs time
subplot(3,1,2)

matlab_plot_2 = plot(tout, cog_rocket, 'm--*');
hold on;
openrocket_plot_2 = plot(...
    openrocket_VarName1(1:indexmax_openrocket), ...
    openrocket_CGlocationcm(1:indexmax_openrocket)/100, ...
    'b--.'...
);
%{
rasaero_plot_2 = plot( ...
    rasaero_Timesec(1:indexmax_rasaero), ...
    rasaero_CG(1:indexmax_rasaero)*in2meter, ...
    'c--o' ...
);
%}
rocksim_plot_2 = plot( ...
    Rocksim_Time(1:indexmax_Rocksim), ...
    Rocksim_CGInches(1:indexmax_Rocksim)*in2meter, ...
    'k- .' ...
);
hold off

h_legend_2 = legend(...
    [matlab_plot_2, openrocket_plot_2, rocksim_plot_2],...
    'Matlab','OpenRocket','Rocksim', ...
    'location', 'northeast' ...
);
set(h_legend_2,'FontSize',12);
set(h_legend_2,'FontName','Courier New');

clear title xlabel ylabel
title('COG vs Time');
ylabel('COG (m)');
xlabel('Time (s)');

%% I_L vs time
subplot(3,1,3)
hold on;
matlab_plot_3 = plot(tout, rocket_moment_inertia_long, 'm--*');
openrocket_plot_3 = plot(...
    openrocket_VarName1(1:indexmax_openrocket), ...
    openrocket_Longitudinalmomentofinertiakgm(1:indexmax_openrocket), ...
    'b--.'...
);
%{
rocksim_plot_3 = plot( ...
    Rocksim_Time(1:indexmax_Rocksim), ...
    Rocksim_LongitudinalmomentofinertiaOuncesInches2(1:indexmax_Rocksim)*in2meter^2*ounce2kilogram, ...
    'k- .' ...
);
%}
hold off;

h_legend_3 = legend(...
    [matlab_plot_3, openrocket_plot_3],...
    'Matlab','OpenRocket','Rocksim', ...
    'location', 'northeast' ...
);
set(h_legend_3,'FontSize',12);
set(h_legend_3,'FontName','Courier New');

clear title xlabel ylabel;
title('I_L vs Time');
ylabel('I_l (m^4)');
xlabel('Time (s)');

%% Conditionally save the plot
if exist('saveplots')
    if saveplots
        saveas(gcf, 'documentation/images/plots/error_cog_cop_il_plot.png');
        export_fig error_drag_plot.png -m2
    end
end

lbf2newton = 4.4482216152605;
ounce2kilogram = .02834952;
newton2kilogram = 9.81;
lbf2kilogram = lbf2newton / newton2kilogram;

%% Find value index of apogee for each source
% OpenRocket
indexmax_openrocket = find(max(openrocket_Altitude) == openrocket_Altitude);
time_to_apogee_openrocket = openrocket_VarName1(indexmax_openrocket);
openrocket_altitude_max = openrocket_Altitude(indexmax_openrocket);

% RasAero
indexmax_rasaero = find(max(rasaero_Altitudeft) == rasaero_Altitudeft);
time_to_apogee_rasaero = rasaero_Timesec(indexmax_rasaero);
rasaero_altitude_max = rasaero_Altitudeft(indexmax_rasaero);

% RockSim
indexmax_Rocksim = find(max(Rocksim_AltitudeFeet) == Rocksim_AltitudeFeet);
time_to_apogee_Rocksim = Rocksim_Time(indexmax_Rocksim);
Rocksim_altitude_max = Rocksim_AltitudeFeet(indexmax_Rocksim);

%% Plot drag coef
subplot(2,1,1);
matlab_plot_1 = plot(tout, thrust, 'm--*');
hold on;
openrocket_plot_1 = plot(...
    openrocket_VarName1(1:indexmax_openrocket), ...
    openrocket_Thrust(1:indexmax_openrocket), ...
    'b--.'...
);
rasaero_plot_1 = plot( ...
    rasaero_Timesec(1:indexmax_rasaero), ...
    rasaero_Thrustlb(1:indexmax_rasaero)*lbf2newton, ...
    'c--o' ...
);
rocksim_plot_1 = plot( ...
    Rocksim_Time(1:indexmax_Rocksim), ...
    Rocksim_yThrustN(1:indexmax_Rocksim), ...
    'k- .' ...
);
hold off;

h_legend = legend(...
    [matlab_plot_1, openrocket_plot_1, rasaero_plot_1, rocksim_plot_1],...
    'Matlab','OpenRocket','Rasaero','Rocksim', ...
    'location', 'northeast' ...
);
set(h_legend,'FontSize',14);
set(h_legend,'FontName','Courier New');

clear title xlabel ylabel
title('Thrust vs Time');
xlabel('Thrust (N)');
ylabel('Time (s)');

subplot(2,1,2)

matlab_plot_2 = plot(tout, mass, 'm--*');
hold on;
openrocket_plot_2 = plot(...
    openrocket_VarName1(1:indexmax_openrocket), ...
    openrocket_Mass(1:indexmax_openrocket)/1000, ...
    'b--.'...
);
rasaero_plot_2 = plot( ...
    rasaero_Timesec(1:indexmax_rasaero), ...
    rasaero_Weightlb(1:indexmax_rasaero)*lbf2kilogram, ...
    'c--o' ...
);
rocksim_plot_2 = plot( ...
    Rocksim_Time(1:indexmax_Rocksim), ...
    Rocksim_MassOunces(1:indexmax_Rocksim)*ounce2kilogram, ...
    'k- .' ...
);
hold off

h_legend_2 = legend(...
    [matlab_plot_2, openrocket_plot_2, rasaero_plot_2, rocksim_plot_2],...
    'Matlab','OpenRocket','RASAero','Rocksim', ...
    'location', 'northeast' ...
);
set(h_legend_2,'FontSize',12);
set(h_legend_2,'FontName','Courier New');

clear title xlabel ylabel
title('Mass vs Time');
xlabel('Mass (kg)');
ylabel('Time (s)');

%% Conditionally save the plot
if exist('saveplots')
    if saveplots
        saveas(gcf, 'documentation/images/plots/error_mass_v_time_plot.png');
        export_fig error_drag_plot.png -m2
    end
end
